---
# EU Trip Tracker - Data Processing Map
# This document describes all personal data processed by the system

system_info:
  name: "EU Trip Tracker"
  purpose: "Track employee compliance with Schengen 90/180-day rule for business travel"
  controller: "Local Organization (Admin)"
  storage_location: "Local SQLite database (eu_tracker.db)"
  third_party_sharing: "None"
  cross_border_transfers: "None"
  automated_decision_making: "None"

entities:
  admin:
    description: "System administrator account for access control"
    fields:
      id:
        type: "integer"
        description: "Internal identifier"
        purpose: "System identification"
        personal_data: false
      password_hash:
        type: "text"
        description: "Hashed password (argon2/bcrypt)"
        purpose: "Authentication"
        personal_data: false
        notes: "Stored as secure hash, never plaintext"
    lawful_basis: "Legitimate Interests (system security)"
    retention: "Permanent (single admin account)"
    access: "Admin only"
    
  employee:
    description: "Employee records for compliance tracking"
    fields:
      id:
        type: "integer"
        description: "Internal identifier"
        purpose: "System identification"
        personal_data: false
      name:
        type: "text"
        description: "Employee full name"
        purpose: "Identify employee for compliance reporting"
        personal_data: true
        special_category: false
        notes: "Only field with identifiable personal data"
    lawful_basis: "Legitimate Interests (business compliance tracking)"
    retention: "Deleted automatically when no trips remain, or 36 months after last trip exit date"
    access: "Admin only"
    data_subject_rights:
      - "Right to access (DSAR export)"
      - "Right to rectification (name update)"
      - "Right to erasure (full deletion)"
      - "Right to data portability (JSON/CSV export)"
      - "Right to object (contact admin)"
    
  trip:
    description: "EU/Schengen business trip records for 90/180 compliance"
    fields:
      id:
        type: "integer"
        description: "Internal identifier"
        purpose: "System identification"
        personal_data: false
      employee_id:
        type: "integer"
        description: "Foreign key to employee"
        purpose: "Link trip to employee"
        personal_data: false
        notes: "Foreign key with CASCADE delete"
      country:
        type: "text"
        description: "ISO country code (e.g., FR, DE, IT)"
        purpose: "Track which Schengen country visited"
        personal_data: false
        notes: "2-letter ISO code, no sensitive data"
      entry_date:
        type: "text (YYYY-MM-DD)"
        description: "Date entered the country"
        purpose: "Calculate days in Schengen area"
        personal_data: false
        notes: "Business travel date, not special category"
      exit_date:
        type: "text (YYYY-MM-DD)"
        description: "Date exited the country"
        purpose: "Calculate days in Schengen area"
        personal_data: false
        notes: "Business travel date, not special category"
      travel_days:
        type: "integer"
        description: "Optional calculated trip duration"
        purpose: "Cache for performance"
        personal_data: false
        notes: "Derived field, can be recalculated"
      created_at:
        type: "text (ISO timestamp)"
        description: "Record creation timestamp"
        purpose: "Audit trail"
        personal_data: false
        notes: "System metadata"
    lawful_basis: "Legal Obligation (Schengen 90/180-day rule compliance)"
    retention: "36 months after exit_date (configurable via RETENTION_MONTHS)"
    access: "Admin only"
    data_subject_rights:
      - "Included in employee DSAR export"
      - "Deleted when employee is deleted"

special_categories:
  present: false
  note: "No special category data (race, religion, health, etc.) is processed"

cookies:
  session_cookie:
    name: "session"
    purpose: "Admin authentication and session management"
    type: "Essential (no consent required)"
    expiry: "Configurable (default 30 minutes idle timeout)"
    security: "HttpOnly, SameSite=Strict, Secure (when HTTPS enabled)"
    data_stored: "Session ID only (no personal data in cookie)"

logging:
  audit_log:
    path: "./logs/audit.log"
    purpose: "Security audit trail for admin actions"
    retention: "Indefinite (manual review/deletion)"
    data_logged:
      - "Timestamp (UTC)"
      - "Action type (login, export, delete, etc.)"
      - "Masked admin identifier (SHA256 hash)"
      - "Request IP address (for rate limiting)"
      - "Employee ID (for DSAR actions)"
    notes: "No passwords or sensitive data logged"

exports:
  dsar_exports:
    format: "ZIP containing JSON + CSV + TXT"
    location: "./exports/"
    retention: "Manual deletion by admin"
    security: "Local filesystem only, no external sharing"
    contents:
      - "employee.json (name, ID, timestamp)"
      - "trips.csv (all trip records)"
      - "processing-notes.txt (purpose, lawful basis, rights info)"

security_measures:
  - "Password hashing (Argon2/bcrypt)"
  - "Session idle timeout"
  - "Login rate limiting (5 attempts per 10 minutes)"
  - "HttpOnly and SameSite=Strict cookies"
  - "No external API calls or third-party SDKs"
  - "Local-only storage (no cloud)"
  - "Foreign key constraints with CASCADE delete"
  - "Admin-only access (no public endpoints except /privacy)"

retention_policy:
  default_months: 36
  implementation: "Automatic purge job (manual trigger or scheduled)"
  cutoff_calculation: "exit_date + RETENTION_MONTHS"
  cascade_deletion: "Employees deleted when no trips remain"

data_minimisation:
  principles:
    - "Only name + trip dates stored"
    - "No email, phone, address, or contact info"
    - "No employment details beyond name"
    - "No financial data"
    - "No biometrics or health data"
    - "No tracking or analytics"
    - "No profiling"



