<!-- Settings Modal -->
<div id="settingsModal" class="settings-modal-overlay" style="display: none;">
    <div class="settings-modal-container">
        <!-- Modal Header -->
        <div class="settings-modal-header">
            <div class="settings-modal-title">
                <h2>Settings</h2>
                <p>Configure system settings and compliance parameters</p>
            </div>
            <button class="settings-modal-close" onclick="closeSettingsModal()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <!-- Modal Body -->
        <div class="settings-modal-body">
            <!-- Left Sidebar Menu -->
            <div class="settings-sidebar">
                <nav class="settings-nav">
                    <button class="settings-nav-item active" data-section="general">
                        <svg class="settings-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                        </svg>
                        <span>General</span>
                    </button>
                    <button class="settings-nav-item" data-section="security">
                        <svg class="settings-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <circle cx="12" cy="16" r="1"></circle>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        <span>Security</span>
                    </button>
                    <button class="settings-nav-item" data-section="compliance">
                        <svg class="settings-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                        </svg>
                        <span>Compliance</span>
                    </button>
                    <button class="settings-nav-item" data-section="data">
                        <svg class="settings-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10,9 9,9 8,9"></polyline>
                        </svg>
                        <span>Data & Export</span>
                    </button>
                    <button class="settings-nav-item" data-section="danger">
                        <svg class="settings-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <span>Danger Zone</span>
                    </button>
                </nav>
            </div>

            <!-- Right Content Area -->
            <div class="settings-content">
                <form id="settingsForm" method="POST" action="{{ url_for('main.admin_settings') }}">
                    <!-- General Settings Section -->
                    <div class="settings-section active" id="general-section">
                        <h3>General Settings</h3>
                        <p class="settings-section-description">Configure basic system settings and interface preferences.</p>
                        
                        <div class="settings-group">
                            <h4>Interface Customization</h4>
                            
                            <!-- Theme Selection -->
                            <div class="form-group">
                                <label>Theme</label>
                                <div class="customization-options">
                                    <button type="button" onclick="setCustomizationTheme('light')" class="customization-option" data-option="theme" data-value="light">
                                        <div class="option-preview light-preview"></div>
                                        <span>Light</span>
                                    </button>
                                    <button type="button" onclick="setCustomizationTheme('dark')" class="customization-option" data-option="theme" data-value="dark">
                                        <div class="option-preview dark-preview"></div>
                                        <span>Dark</span>
                                    </button>
                                    <button type="button" onclick="setCustomizationTheme('high-contrast')" class="customization-option" data-option="theme" data-value="high-contrast">
                                        <div class="option-preview high-contrast-preview"></div>
                                        <span>High Contrast</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Density Selection -->
                            <div class="form-group">
                                <label>Density</label>
                                <div class="customization-options">
                                    <button type="button" onclick="setCustomizationDensity('compact')" class="customization-option" data-option="density" data-value="compact">
                                        <div class="density-preview compact"></div>
                                        <span>Compact</span>
                                    </button>
                                    <button type="button" onclick="setCustomizationDensity('comfortable')" class="customization-option" data-option="density" data-value="comfortable">
                                        <div class="density-preview comfortable"></div>
                                        <span>Comfortable</span>
                                    </button>
                                    <button type="button" onclick="setCustomizationDensity('spacious')" class="customization-option" data-option="density" data-value="spacious">
                                        <div class="density-preview spacious"></div>
                                        <span>Spacious</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Dashboard Layout -->
                            <div class="form-group">
                                <label>Dashboard Layout</label>
                                <div class="customization-options">
                                    <button type="button" onclick="setCustomizationLayout('grid')" class="customization-option" data-option="layout" data-value="grid">
                                        <div class="layout-preview grid"></div>
                                        <span>Grid View</span>
                                    </button>
                                    <button type="button" onclick="setCustomizationLayout('list')" class="customization-option" data-option="layout" data-value="list">
                                        <div class="layout-preview list"></div>
                                        <span>List View</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Notifications -->
                            <div class="form-group">
                                <label>Notifications</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="notif-email" onchange="setCustomizationNotification('email', this.checked)">
                                        <span class="checkmark"></span>
                                        Email notifications
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="notif-browser" onchange="setCustomizationNotification('browser', this.checked)">
                                        <span class="checkmark"></span>
                                        Browser notifications
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="notif-sound" onchange="setCustomizationNotification('sound', this.checked)">
                                        <span class="checkmark"></span>
                                        Sound alerts
                                    </label>
                                </div>
                            </div>

                            <!-- Date Format -->
                            <div class="form-group">
                                <label for="date-format">Date Format</label>
                                <select id="date-format" class="form-control" onchange="setCustomizationDateFormat(this.value)">
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                </select>
                            </div>

                            <!-- Reset Button -->
                            <div class="form-group">
                                <button type="button" onclick="resetCustomizationToDefaults()" class="btn btn-outline" style="width: 100%;">
                                    Reset to Defaults
                                </button>
                            </div>
                        </div>

                        <!-- News Filter Settings -->
                        <div class="settings-group">
                            <h4>News Filter</h4>
                            <div class="form-group">
                                <label for="news_filter_region">News Region Filter</label>
                                <select id="news_filter_region" name="news_filter_region" class="form-control">
                                    <option value="EU_ONLY" {% if config.get('NEWS_FILTER_REGION', 'EU_ONLY') == 'EU_ONLY' %}selected{% endif %}>
                                        EU/Schengen Only
                                    </option>
                                    <option value="ALL" {% if config.get('NEWS_FILTER_REGION', 'EU_ONLY') == 'ALL' %}selected{% endif %}>
                                        All Regions
                                    </option>
                                </select>
                                <small class="form-text">Filter news to show only EU/Schengen travel items or all regions.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings Section -->
                    <div class="settings-section" id="security-section">
                        <h3>Security Settings</h3>
                        <p class="settings-section-description">Configure password policies and session security.</p>
                        
                        <div class="settings-group">
                            <h4>Session Security</h4>
                            <div class="form-group">
                                <label for="session_timeout">Session Idle Timeout (minutes)</label>
                                <input type="number" id="session_timeout" name="session_timeout" 
                                       value="{{ config.SESSION_IDLE_TIMEOUT_MINUTES }}" min="5" max="480"
                                       class="form-control">
                                <small class="form-text">Automatically log out after this many minutes of inactivity.</small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="session_cookie_secure" 
                                           {% if config.SESSION_COOKIE_SECURE %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                    Use Secure Cookies (HTTPS only)
                                </label>
                                <small class="form-text">Enable this when using HTTPS. Disable for local HTTP development.</small>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Password Security</h4>
                            <div class="form-group">
                                <label for="password_scheme">Password Hashing Scheme</label>
                                <select id="password_scheme" name="password_scheme" class="form-control">
                                    <option value="argon2" {% if config.PASSWORD_HASH_SCHEME == 'argon2' %}selected{% endif %}>
                                        Argon2 (Recommended)
                                    </option>
                                    <option value="bcrypt" {% if config.PASSWORD_HASH_SCHEME == 'bcrypt' %}selected{% endif %}>
                                        bcrypt
                                    </option>
                                </select>
                                <small class="form-text">Argon2 is recommended for maximum security.</small>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Change Admin Password</h4>
                            <div class="form-group">
                                <label for="new_password">New Password</label>
                                <input type="password" id="new_password" name="new_password" 
                                       class="form-control" minlength="8">
                                <small class="form-text">Minimum 8 characters, must contain letters and numbers.</small>
                            </div>
                            <button type="button" class="btn btn-warning" onclick="changePassword()">Change Password</button>
                        </div>
                    </div>

                    <!-- Compliance Settings Section -->
                    <div class="settings-section" id="compliance-section">
                        <h3>Compliance Settings</h3>
                        <p class="settings-section-description">Configure compliance thresholds and risk levels.</p>
                        
                        <div class="settings-group">
                            <h4>Future Job Compliance Forecast</h4>
                            <div class="form-group">
                                <label for="warning_threshold">Warning Threshold (days)</label>
                                <input type="number" id="warning_threshold" name="warning_threshold" 
                                       value="{{ config.get('FUTURE_JOB_WARNING_THRESHOLD', 80) }}" 
                                       min="1" max="90" class="form-control">
                                <small class="form-text">
                                    Show yellow warning when future trips would use this many days or more (must be between 1-90).
                                    Default is 80 days. Red warnings always show for trips that would exceed 90 days.
                                </small>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Risk Level Thresholds</h4>
                            <div class="form-group">
                                <label for="risk_threshold_green">Green Threshold (days remaining)</label>
                                <input type="number" id="risk_threshold_green" name="risk_threshold_green" 
                                       value="{{ config.get('RISK_THRESHOLDS', {}).get('green', 30) }}" 
                                       min="1" max="90" class="form-control">
                                <small class="form-text">
                                    Days remaining >= this value will show green badges. Default is 30 days.
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="risk_threshold_amber">Amber Threshold (days remaining)</label>
                                <input type="number" id="risk_threshold_amber" name="risk_threshold_amber" 
                                       value="{{ config.get('RISK_THRESHOLDS', {}).get('amber', 10) }}" 
                                       min="0" max="89" class="form-control">
                                <small class="form-text">
                                    Days remaining between this value and green threshold will show amber badges. 
                                    Days remaining < this value will show red badges. Default is 10 days.
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Data & Export Settings Section -->
                    <div class="settings-section" id="data-section">
                        <h3>Data & Export Settings</h3>
                        <p class="settings-section-description">Configure data retention and export settings.</p>
                        
                        <div class="settings-group">
                            <h4>Data Retention</h4>
                            <div class="form-group">
                                <label for="retention_months">Retention Period (months)</label>
                                <input type="number" id="retention_months" name="retention_months" 
                                       value="{{ config.RETENTION_MONTHS }}" min="1" max="120"
                                       class="form-control">
                                <small class="form-text">Trips will be deleted this many months after their exit date.</small>
                            </div>
                        </div>

                        <div class="settings-group">
                            <h4>Export & Audit</h4>
                            <div class="form-group">
                                <label for="export_dir">DSAR Export Directory</label>
                                <input type="text" id="export_dir" name="export_dir" 
                                       value="{{ config.DSAR_EXPORT_DIR }}" class="form-control">
                                <small class="form-text">Directory where DSAR export ZIP files are saved.</small>
                            </div>

                            <div class="form-group">
                                <label for="audit_log">Audit Log Path</label>
                                <input type="text" id="audit_log" name="audit_log" 
                                       value="{{ config.AUDIT_LOG_PATH }}" class="form-control">
                                <small class="form-text">Path to the audit log file.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Danger Zone Section -->
                    <div class="settings-section" id="danger-section">
                        <h3>Danger Zone</h3>
                        <p class="settings-section-description">Irreversible actions that will permanently delete data.</p>
                        
                        <div class="settings-group danger-group">
                            <h4>Delete All Data</h4>
                            <div class="danger-warning">
                                <p><strong>WARNING:</strong> This action will permanently delete all BUSINESS TRAVEL data and exported files from the system.
                                Personal holiday trips will be preserved. This cannot be undone. Use only for GDPR compliance or complete system reset.</p>
                            </div>
                            <div class="form-group">
                                <label for="confirmation">Type "DELETE ALL DATA" to confirm:</label>
                                <input type="text" id="confirmation" name="confirmation" 
                                       class="form-control danger-input" required 
                                       placeholder="DELETE ALL DATA">
                            </div>
                            <button type="button" class="btn btn-danger" onclick="confirmDeleteAll()">
                                Delete All Data Permanently
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal Footer -->
        <div class="settings-modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
            <button type="submit" form="settingsForm" class="btn btn-primary">Save Settings</button>
        </div>
    </div>
</div>

<style>
/* Settings Modal Styles */
.settings-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.settings-modal-overlay.active {
    opacity: 1;
}

.settings-modal-container {
    background: white;
    border-radius: 12px;
    width: 1000px;
    height: 700px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 1200px) {
    .settings-modal-container {
        width: 90%;
        max-width: 1000px;
        height: 80vh;
        max-height: 700px;
    }
    
    .settings-modal-body {
        height: calc(80vh - 120px - 80px);
        max-height: calc(700px - 120px - 80px);
    }
    
    .settings-content {
        max-height: calc(80vh - 120px - 80px);
    }
}

@media (max-width: 768px) {
    .settings-modal-container {
        width: 95%;
        height: 90vh;
    }
    
    .settings-modal-body {
        height: calc(90vh - 120px - 80px);
    }
    
    .settings-content {
        max-height: calc(90vh - 120px - 80px);
    }
    
    .settings-sidebar {
        width: 200px;
    }
}

.settings-modal-overlay.active .settings-modal-container {
    transform: scale(1);
}

.settings-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 30px;
    border-bottom: 1px solid #e5e7eb;
    background: #f9fafb;
    border-radius: 12px 12px 0 0;
}

.settings-modal-title h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 600;
    color: #111827;
}

.settings-modal-title p {
    margin: 4px 0 0 0;
    font-size: 14px;
    color: #6b7280;
}

.settings-modal-close {
    width: 40px;
    height: 40px;
    background: rgba(107, 114, 128, 0.1);
    border: 2px solid rgba(107, 114, 128, 0.2);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    color: #6b7280;
}

.settings-modal-close:hover {
    background: rgba(107, 114, 128, 0.2);
    transform: rotate(90deg);
    color: #374151;
}

.settings-modal-body {
    display: flex;
    flex: 1;
    min-height: 0;
    height: calc(700px - 120px - 80px); /* Total height minus header and footer */
    overflow: hidden;
}

.settings-sidebar {
    width: 250px;
    background: #f8fafc;
    border-right: 1px solid #e5e7eb;
    padding: 20px 0;
}

.settings-nav {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.settings-nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: #6b7280;
    transition: all 0.2s;
    text-align: left;
    width: 100%;
}

.settings-nav-item:hover {
    background: #e5e7eb;
    color: #374151;
}

.settings-nav-item.active {
    background: #dbeafe;
    color: #1d4ed8;
    border-right: 3px solid #1d4ed8;
}

.settings-nav-icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
}

.settings-content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
    height: 100%;
    max-height: calc(700px - 120px - 80px); /* Total height minus header and footer */
}

/* Custom scrollbar styling */
.settings-content::-webkit-scrollbar {
    width: 8px;
}

.settings-content::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

.settings-content::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
}

.settings-content::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

.settings-section {
    display: none;
}

.settings-section.active {
    display: block;
}

.settings-section h3 {
    margin: 0 0 8px 0;
    font-size: 20px;
    font-weight: 600;
    color: #111827;
}

.settings-section-description {
    margin: 0 0 24px 0;
    font-size: 14px;
    color: #6b7280;
}

.settings-group {
    margin-bottom: 32px;
}

.settings-group h4 {
    margin: 0 0 16px 0;
    font-size: 16px;
    font-weight: 600;
    color: #374151;
}

.danger-group {
    border: 2px solid #fecaca;
    border-radius: 8px;
    padding: 20px;
    background: #fef2f2;
}

.danger-warning {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 16px;
    border-radius: 6px;
    margin-bottom: 16px;
}

.danger-warning p {
    margin: 0;
    color: #92400e;
    font-size: 14px;
}

.danger-input {
    border-color: #fca5a5 !important;
}

.settings-modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 12px;
    padding: 20px 30px;
    border-top: 1px solid #e5e7eb;
    background: #f9fafb;
    border-radius: 0 0 12px 12px;
}

/* Form Styles */
.form-group {
    margin-bottom: 20px;
}

.form-control {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-control:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-text {
    display: block;
    margin-top: 6px;
    color: #6b7280;
    font-size: 13px;
}

label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #374151;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-weight: 500;
    color: #374151;
}

.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin: 0;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
}

.btn-primary {
    background: #3b82f6;
    color: white;
}

.btn-primary:hover {
    background: #2563eb;
}

.btn-secondary {
    background: #6b7280;
    color: white;
}

.btn-secondary:hover {
    background: #4b5563;
}

.btn-outline {
    background: transparent;
    color: #3b82f6;
    border: 1px solid #3b82f6;
}

.btn-outline:hover {
    background: #3b82f6;
    color: white;
}

.btn-danger {
    background: #dc2626;
    color: white;
}

.btn-danger:hover {
    background: #b91c1c;
}

/* Customization Options Styles */
.customization-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 8px;
}

.customization-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    color: #374151;
}

.customization-option:hover {
    border-color: #3b82f6;
    background: #f8fafc;
}

.customization-option.active {
    border-color: #3b82f6;
    background: #dbeafe;
    color: #1d4ed8;
}

.option-preview {
    width: 40px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid #d1d5db;
}

.light-preview {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
}

.dark-preview {
    background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
}

.high-contrast-preview {
    background: linear-gradient(135deg, #000000 0%, #ffffff 50%, #000000 100%);
}

.density-preview {
    width: 40px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid #d1d5db;
    background: #f3f4f6;
    position: relative;
}

.density-preview.compact::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.density-preview.compact::after {
    content: '';
    position: absolute;
    top: 6px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.density-preview.comfortable::before {
    content: '';
    position: absolute;
    top: 3px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.density-preview.comfortable::after {
    content: '';
    position: absolute;
    top: 9px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.density-preview.spacious::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.density-preview.spacious::after {
    content: '';
    position: absolute;
    top: 12px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.layout-preview {
    width: 40px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid #d1d5db;
    background: #f3f4f6;
    position: relative;
}

.layout-preview.grid::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 8px;
    height: 8px;
    background: #6b7280;
    border-radius: 1px;
}

.layout-preview.grid::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 12px;
    width: 8px;
    height: 8px;
    background: #6b7280;
    border-radius: 1px;
}

.layout-preview.list::before {
    content: '';
    position: absolute;
    top: 3px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.layout-preview.list::after {
    content: '';
    position: absolute;
    top: 7px;
    left: 2px;
    right: 2px;
    height: 2px;
    background: #6b7280;
    border-radius: 1px;
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 8px;
}
</style>

<script>
// Settings Modal Functions
function showSettingsModal() {
    const modal = document.getElementById('settingsModal');
    if (!modal) return;
    
    modal.style.display = 'flex';
    setTimeout(() => {
        modal.classList.add('active');
        // Load customization values when modal opens
        loadCustomizationValues();
        updateCustomizationActiveStates();
    }, 10);
    
    document.body.style.overflow = 'hidden';
}

function closeSettingsModal() {
    const modal = document.getElementById('settingsModal');
    if (!modal) return;
    
    modal.classList.remove('active');
    setTimeout(() => {
        modal.style.display = 'none';
    }, 300);
    
    document.body.style.overflow = '';
}

// Settings Navigation
document.addEventListener('DOMContentLoaded', function() {
    const navItems = document.querySelectorAll('.settings-nav-item');
    const sections = document.querySelectorAll('.settings-section');
    
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            const targetSection = this.dataset.section;
            
            // Remove active class from all nav items and sections
            navItems.forEach(nav => nav.classList.remove('active'));
            sections.forEach(section => section.classList.remove('active'));
            
            // Add active class to clicked nav item and corresponding section
            this.classList.add('active');
            const targetElement = document.getElementById(targetSection + '-section');
            if (targetElement) {
                targetElement.classList.add('active');
            }
        });
    });
    
    // Close modal on background click
    const modal = document.getElementById('settingsModal');
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettingsModal();
            }
        });
    }
    
    // Close modal on ESC key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeSettingsModal();
        }
    });
});

function changePassword() {
    const newPassword = document.getElementById('new_password').value;
    if (!newPassword || newPassword.length < 8) {
        alert('Password must be at least 8 characters long.');
        return;
    }
    
    if (confirm('Are you sure you want to change your password?')) {
        // Create a form for the password change action
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("main.change_password") }}';
        
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'new_password';
        input.value = newPassword;
        form.appendChild(input);
        
        document.body.appendChild(form);
        form.submit();
    }
}

function confirmDeleteAll() {
    const confirmation = document.getElementById('confirmation').value;
    if (confirmation === 'DELETE ALL DATA') {
        if (confirm('Are you absolutely sure? This will delete ALL data and cannot be undone!')) {
            // Create a form for the delete action
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("main.delete_all_data") }}';
            
            // Add CSRF token if available
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
            if (csrfToken) {
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrf_token';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
            }
            
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'confirmation';
            input.value = confirmation;
            form.appendChild(input);
            
            document.body.appendChild(form);
            form.submit();
        }
    } else {
        alert('Please type "DELETE ALL DATA" exactly to confirm.');
    }
}

// Customization Functions
function setCustomizationTheme(theme) {
    console.log('Setting theme to:', theme);
    if (window.customizationSystem) {
        window.customizationSystem.setTheme(theme);
        updateCustomizationActiveStates();
        console.log('Theme set successfully, current theme:', window.customizationSystem.preferences.theme);
    } else {
        console.error('Customization system not available');
    }
}

function setCustomizationDensity(density) {
    if (window.customizationSystem) {
        window.customizationSystem.setDensity(density);
        updateCustomizationActiveStates();
    }
}

function setCustomizationLayout(layout) {
    if (window.customizationSystem) {
        window.customizationSystem.setDashboardLayout(layout);
        updateCustomizationActiveStates();
    }
}

function setCustomizationNotification(type, enabled) {
    if (window.customizationSystem) {
        window.customizationSystem.setNotification(type, enabled);
    }
}

function setCustomizationDateFormat(format) {
    if (window.customizationSystem) {
        window.customizationSystem.setDateFormat(format);
    }
}

function resetCustomizationToDefaults() {
    if (window.customizationSystem) {
        window.customizationSystem.resetToDefaults();
        updateCustomizationActiveStates();
        loadCustomizationValues();
    }
}

function updateCustomizationActiveStates() {
    if (!window.customizationSystem) return;
    
    const prefs = window.customizationSystem.preferences;
    
    // Update theme buttons
    document.querySelectorAll('[data-option="theme"]').forEach(btn => {
        const isActive = btn.dataset.value === prefs.theme;
        btn.classList.toggle('active', isActive);
        // Also update visual styling
        if (isActive) {
            btn.style.borderColor = '#3b82f6';
            btn.style.backgroundColor = '#dbeafe';
            btn.style.color = '#1d4ed8';
        } else {
            btn.style.borderColor = '#e5e7eb';
            btn.style.backgroundColor = 'white';
            btn.style.color = '#374151';
        }
    });
    
    // Update density buttons
    document.querySelectorAll('[data-option="density"]').forEach(btn => {
        const isActive = btn.dataset.value === prefs.density;
        btn.classList.toggle('active', isActive);
        // Also update visual styling
        if (isActive) {
            btn.style.borderColor = '#3b82f6';
            btn.style.backgroundColor = '#dbeafe';
            btn.style.color = '#1d4ed8';
        } else {
            btn.style.borderColor = '#e5e7eb';
            btn.style.backgroundColor = 'white';
            btn.style.color = '#374151';
        }
    });
    
    // Update layout buttons
    document.querySelectorAll('[data-option="layout"]').forEach(btn => {
        const isActive = btn.dataset.value === prefs.dashboardLayout;
        btn.classList.toggle('active', isActive);
        // Also update visual styling
        if (isActive) {
            btn.style.borderColor = '#3b82f6';
            btn.style.backgroundColor = '#dbeafe';
            btn.style.color = '#1d4ed8';
        } else {
            btn.style.borderColor = '#e5e7eb';
            btn.style.backgroundColor = 'white';
            btn.style.color = '#374151';
        }
    });
}

function loadCustomizationValues() {
    if (!window.customizationSystem) return;
    
    const prefs = window.customizationSystem.preferences;
    
    // Set notification checkboxes
    document.getElementById('notif-email').checked = prefs.notifications.email;
    document.getElementById('notif-browser').checked = prefs.notifications.browser;
    document.getElementById('notif-sound').checked = prefs.notifications.sound;
    
    // Set date format
    document.getElementById('date-format').value = prefs.dateFormat;
}

// Make functions globally available
window.showSettingsModal = showSettingsModal;
window.closeSettingsModal = closeSettingsModal;
window.changePassword = changePassword;
window.confirmDeleteAll = confirmDeleteAll;
window.setCustomizationTheme = setCustomizationTheme;
window.setCustomizationDensity = setCustomizationDensity;
window.setCustomizationLayout = setCustomizationLayout;
window.setCustomizationNotification = setCustomizationNotification;
window.setCustomizationDateFormat = setCustomizationDateFormat;
window.resetCustomizationToDefaults = resetCustomizationToDefaults;
</script>
